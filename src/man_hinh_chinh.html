<!DOCTYPE html>
<meta charset="utf-8">

<div id = "tro_choi">
    <div id="header">
        <div class="thong_bao kho_chua">
            <div class="ten_kho">KHO 1</div>
            <div class="ket_qua_hien_tai">0</div>
        </div>
        <div id="ten_tro_choi" class="thong_bao">
            Ô ĂN QUAN
        </div>
        <div class="thong_bao kho_chua">
            <div class="ten_kho">KHO 2</div>
            <div class="ket_qua_hien_tai">0</div>
        </div>
    </div>
    <div id="body">
        <div id="ban_co"></div>
        <div id="thong_tin"></div>        
    </div>
</div>

<style>
    #tro_choi{
        border: 2px black dashed;
        overflow: scroll;
    }
    #header{
        width: 910px;
        margin: 30px 30px;
        height: 150px;
    }
    #ten_tro_choi{
        width: 365px;
        text-align: center;
        font-size: 40pt;
        font-family: Helvetica;
        background-color: yellow;
    }
    .thong_bao{
        display: inline-block;
    }
    .kho_chua{
        width: 256px;
        height: 150px;
        border: 1px black solid;
    }
    .ten_kho{
        text-align: center;
        font-size: 30pt;
        border-bottom: 1px black solid;
    }
    .ket_qua_hien_tai{
        text-align: center;
        font-size: 50pt;
    }
    #thong_tin{
        background-color: aqua;
        width: 896px;
        margin: 30px 30px;
        height: 150px;
    }
    #ban_co{
        position: relative;
        margin: 30px 30px;
    }
    /* cac thuoc tinh cho o quan ben trai */
    #id_0{
        position: relative;
        width: 129px;
        height: 257px;
        border: 0.5px black solid;
        border-top-left-radius: 125px;
        border-bottom-left-radius: 125px;
    }
    /* Cac thuoc tinh cho o quan ben phai */
    #id_6{
        position: absolute;
        width: 129px;
        height: 257px;
        border: 0.5px black solid;
        border-top-right-radius: 125px;
        border-bottom-right-radius: 125px;
    }
    .o_dan_o_giua{
        position: absolute;
        border: 0.5px black solid;
        width: 129px;
        height: 129px;
    }
    .o_vuong_nho{
        position: absolute;
        width: 16px;
        height: 16px;
        border: 0.5px blue dotted;
    }
</style>
    
<script>
    var so_dan_cac_o = [3, 5, 5, 5, 5, 5, 3, 5, 5, 5, 5, 5];
    // Điểm của từng người chơi
    var diem_nguoi_thu_1 = 0;
    var diem_nguoi_thu_2 = 0;
    
    // Hướng đi đang được lựa chọn
    // Trái: -1, Phải: 1, Chưa chọn: 0
    var huong_di_chuyen = 0;

    // Số lượng sỏi mà người chơi đang cầm trên tay
    var soi_tren_tay = 0;

    var ban_co = document.querySelector("#ban_co");
    // Hien thi cac o quan va o dan
    ve_cac_o_dan_va_quan();

    // Hàm vẽ các khung của bàn cờ và số lượng quan và dân trong đó
    function ve_cac_o_dan_va_quan(){
        // Ve o quan ben trai
        var o_quan_ben_trai = document.createElement("canvas");
        o_quan_ben_trai.setAttribute("id","id_0");
        o_quan_ben_trai.style.top = 0 + "px";
        o_quan_ben_trai.style.left = 0 + "px";
        ban_co.appendChild(o_quan_ben_trai);

        // Ve o quan ben phai
        var o_quan_ben_phai = document.createElement("canvas");
        o_quan_ben_phai.setAttribute("id","id_6");
        o_quan_ben_phai.style.top = 0 + "px";
        o_quan_ben_phai.style.left = 128*6 + "px";
        ban_co.appendChild(o_quan_ben_phai);

        // Vẽ các ô dân ở hàng trên
        for(var i = 1; i <= 5; i++){
            var o_dan_hang_tren = document.createElement("canvas");
            o_dan_hang_tren.setAttribute("id", "id_" + i);
            o_dan_hang_tren.setAttribute("class", "o_dan_o_giua");
            o_dan_hang_tren.style.top = 0 + "px";
            o_dan_hang_tren.style.left = 128*i + "px";
            hien_thi_so_dan_tung_o(o_dan_hang_tren, so_dan_cac_o[i]);
            ban_co.appendChild(o_dan_hang_tren);
        }

        // Ve cac o dan o hang duoi
        var bien_tam = 1;
        for(var i = 11; i >= 7; i--){
            var o_dan_hang_duoi = document.createElement("canvas");
            o_dan_hang_duoi.setAttribute("id", "id_" + i);
            o_dan_hang_duoi.setAttribute("class", "o_dan_o_giua");
            o_dan_hang_duoi.style.top = 128 + "px";
            o_dan_hang_duoi.style.left = 128*bien_tam + "px";
            hien_thi_so_dan_tung_o(o_dan_hang_duoi, so_dan_cac_o[i]);
            ban_co.appendChild(o_dan_hang_duoi);
            bien_tam = bien_tam + 1;
        }
    }
    
    // Hàm hiển thị số lượng dân trong từng ô dân
    function hien_thi_so_dan_tung_o(o_dan, so_luong_dan){
            // Một vài phép tính để vẽ số dân cho phù hợp
            var so_hang_day_du_can_ve = Math.floor(so_luong_dan / 9);
            var so_cot_can_ve_them = so_luong_dan % 9;

            var dan = new Image();
            dan.src = "../images/dan.png";
            var be_mat = o_dan.getContext("2d");
            dan.addEventListener("load", function(){
                for(var cot = 0; cot < 288; cot += 32){
                    for(var hang = 0; hang < (32*so_hang_day_du_can_ve); hang += 32){
                        be_mat.drawImage(
                            dan,    
                            0, 0, 32, 32,
                            cot, hang, 32, 32
                        );
                    }
                }
                // Vẽ thêm một hàng không đầy đủ nữa
                for(var cot = 0; cot < (32*so_cot_can_ve_them); cot += 32){
                    be_mat.drawImage(
                        dan,
                        0, 0, 32, 32,
                        cot, 32*so_hang_day_du_can_ve, 32, 32
                    );           
                }
            }, false);
        }


</script>